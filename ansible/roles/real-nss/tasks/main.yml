---
- name: Install nscd and nslcd
  dnf:
    name:
      - nscd
      - nslcd
    state: present
- name: Configure nscd for caching
  lineinfile:
    path: /etc/nscd.conf
    regexp: '(?i)^#?\s*{{ item | regex_search("^(\S+)") }}\s*{{ item | regex_search("^(passwd|group|hosts|services|netgroup)") }}\s'
    line: "{{ item }}"
  loop:
    - threads 32
    - max-threads 128
    - negative-time-to-live passwd 5
    - negative-time-to-live group 5
    - suggested-size passwd 1999
    - persistent passwd no
    - suggested-size group 1999
    - persistent group no
    - suggested-size hosts 1999
